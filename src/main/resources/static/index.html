<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Usuário</title>
    <script>
        let etapaAtual = 1; // Controle das etapas
        let dadosTemporarios = {}; // Armazena dados das etapas anteriores

        async function enviarDados(etapa) {
            const urlBase = "http://localhost:8080/api/usuarios"; // URL base da API
            const form = document.querySelector(`#form-etapa${etapa}`);
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries()); // Converte dados do formulário para JSON

            try {
                let url = `${urlBase}/etapa${etapa}`;
                let response = await fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    let mensagem = await response.text();
                    alert(mensagem);

                    if (etapa < 3) {
                        etapaAtual++;
                        mostrarEtapa(etapaAtual);
                    } else if (etapa === 3) {
                        confirmarCadastro();
                    }
                } else {
                    let erro = await response.text();
                    alert(`Erro: ${erro}`);
                }
            } catch (error) {
                console.error("Erro ao enviar dados:", error);
                alert("Ocorreu um erro. Tente novamente.");
            }
        }

        async function confirmarCadastro() {
            const url = "http://localhost:8080/api/usuarios/confirmar";
            try {
                let response = await fetch(url, {
                    method: "POST"
                });

                if (response.ok) {
                    alert("Cadastro realizado com sucesso!");
                } else {
                    let erro = await response.text();
                    alert(`Erro ao confirmar cadastro: ${erro}`);
                }
            } catch (error) {
                console.error("Erro ao confirmar cadastro:", error);
                alert("Ocorreu um erro. Tente novamente.");
            }
        }

        function mostrarEtapa(etapa) {
            document.querySelectorAll(".etapa").forEach(div => div.style.display = "none");
            document.querySelector(`#etapa${etapa}`).style.display = "block";
        }

        window.onload = () => {
            mostrarEtapa(etapaAtual);
        };
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .etapa {
            display: none;
        }
        button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Cadastro de Usuário</h1>

    <!-- Etapa 1: Dados do Usuário -->
    <div id="etapa1" class="etapa">
        <h2>Etapa 1: Dados do Usuário</h2>
        <form id="form-etapa1" onsubmit="event.preventDefault(); enviarDados(1);">
            <label for="nome">Nome:</label><br>
            <input type="text" id="nome" name="nome" required><br><br>

            <label for="email">Email:</label><br>
            <input type="email" id="email" name="email" required><br><br>

            <label for="cpf">CPF:</label><br>
            <input type="text" id="cpf" name="cpf" required><br><br>

            <label for="dataNascimento">Data de Nascimento:</label><br>
            <input type="date" id="dataNascimento" name="dataNascimento" required><br><br>

            <label for="senha">Senha:</label><br>
            <input type="password" id="senha" name="senha" required><br><br>

            <label for="confirmacaoSenha">Confirmação de Senha:</label><br>
            <input type="password" id="confirmacaoSenha" name="confirmacaoSenha" required><br><br>

            <button type="submit">Próxima Etapa</button>
        </form>
    </div>

    <!-- Etapa 2: Telefone -->
    <div id="etapa2" class="etapa">
        <h2>Etapa 2: Telefone</h2>
        <form id="form-etapa2" onsubmit="event.preventDefault(); enviarDados(2);">
            <label for="telefone">Telefone:</label><br>
            <input type="text" id="telefone" name="telefone" required><br><br>

            <button type="submit">Próxima Etapa</button>
        </form>
    </div>

    <!-- Etapa 3: Endereço -->
    <div id="etapa3" class="etapa">
        <h2>Etapa 3: Endereço</h2>
        <form id="form-etapa3" onsubmit="event.preventDefault(); enviarDados(3);">
            <label for="rua">Rua:</label><br>
            <input type="text" id="rua" name="rua" required><br><br>

            <label for="cidade">Cidade:</label><br>
            <input type="text" id="cidade" name="cidade" required><br><br>

            <label for="estado">Estado:</label><br>
            <input type="text" id="estado" name="estado" required><br><br>

            <label for="cep">CEP:</label><br>
            <input type="text" id="cep" name="cep" required><br><br>

            <button type="submit">Confirmar Cadastro</button>
        </form>
    </div>
</body>
</html>
