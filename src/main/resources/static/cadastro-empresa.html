<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Empresa</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f3f3f3;
        }
        .container {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
        }
        .hidden {
            display: none;
        }
        .form-step {
            margin-bottom: 20px;
        }
        .form-step.active {
            display: block;
        }
        button {
            background: #4CAF50;
            color: #fff;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 5px 0 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <form id="cadastroEmpresaForm">
            <!-- Etapa 1: Dados da Empresa -->
            <div class="form-step active" id="step1">
                <h2>Dados da Empresa</h2>
                <input type="text" id="nomeCorporativo" placeholder="Nome Corporativo" required />
                <input type="email" id="email" placeholder="Email Corporativo" required />
                <input type="text" id="cnpj" placeholder="CNPJ (somente números)" maxlength="14" required />
                <input type="text" id="responsavel" placeholder="Responsável" required />
                <input type="password" id="senha" placeholder="Senha" required />
                <button type="button" onclick="proximaEtapa(2)">Próximo</button>
            </div>

            <!-- Etapa 2: Telefone -->
            <div class="form-step hidden" id="step2">
                <h2>Telefone</h2>
                <input type="text" id="telefone" placeholder="Telefone com DDD" required />
                <button type="button" onclick="voltarEtapa(1)">Voltar</button>
                <button type="button" onclick="proximaEtapa(3)">Próximo</button>
            </div>

            <!-- Etapa 3: Endereço -->
            <div class="form-step hidden" id="step3">
                <h2>Endereço</h2>
                <input type="text" id="rua" placeholder="Rua" required />
                <input type="text" id="cidade" placeholder="Cidade" required />
                <input type="text" id="estado" placeholder="Estado (UF)" maxlength="2" required />
                <input type="text" id="cep" placeholder="CEP (somente números)" maxlength="8" required />
                <button type="button" onclick="voltarEtapa(2)">Voltar</button>
                <button type="button" onclick="confirmarCadastro()">Confirmar Cadastro</button>
            </div>
        </form>
    </div>

    <script>
        const BASE_URL = "http://127.0.0.1:8080/api/empresas"; // Ajuste a URL para o servidor backend

        let etapaAtual = 1;

        function proximaEtapa(etapa) {
            document.getElementById(`step${etapaAtual}`).classList.add("hidden");
            document.getElementById(`step${etapa}`).classList.remove("hidden");
            etapaAtual = etapa;
        }

        function voltarEtapa(etapa) {
            document.getElementById(`step${etapaAtual}`).classList.add("hidden");
            document.getElementById(`step${etapa}`).classList.remove("hidden");
            etapaAtual = etapa;
        }

        async function confirmarCadastro() {
            const empresaDados = {
                nomeCorporativo: document.getElementById("nomeCorporativo").value,
                email: document.getElementById("email").value,
                cnpj: document.getElementById("cnpj").value,
                responsavel: document.getElementById("responsavel").value,
                senha: document.getElementById("senha").value,
            };

            const telefone = {
                telefone: document.getElementById("telefone").value,
            };

            const endereco = {
                rua: document.getElementById("rua").value,
                cidade: document.getElementById("cidade").value,
                estado: document.getElementById("estado").value,
                cep: document.getElementById("cep").value,
            };

            try {
                // Etapa 1: Enviar dados da empresa
                let response = await fetch(`${BASE_URL}/etapa1`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(empresaDados),
                });
                if (!response.ok) throw new Error(await response.text());

                // Etapa 2: Enviar telefone
                response = await fetch(`${BASE_URL}/etapa2`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(telefone),
                });
                if (!response.ok) throw new Error(await response.text());

                // Etapa 3: Enviar endereço
                response = await fetch(`${BASE_URL}/etapa3`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(endereco),
                });
                if (!response.ok) throw new Error(await response.text());

                // Confirmar cadastro
                response = await fetch(`${BASE_URL}/confirmar`, { method: "POST" });
                if (!response.ok) throw new Error(await response.text());

                alert("Cadastro realizado com sucesso!");
                window.location.reload();
            } catch (error) {
                alert(`Erro ao cadastrar: ${error.message}`);
            }
        }
    </script>
</body>
</html>
